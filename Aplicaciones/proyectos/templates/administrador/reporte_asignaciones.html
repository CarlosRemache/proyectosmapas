{% extends "plantillaadministrador.html" %}
{% load static %}
{% block contener %}

<style>
  body{ background:#ffffff; }

  .box{
    width:92%;
    max-width:1150px;
    margin:30px auto;
    background:#06080D;
    color:#F3F4F6;
    padding:24px;
    border-radius:18px;
    border:1px solid #1F2937;
    box-shadow:0 12px 30px rgba(0,0,0,0.4);
  }

  .box h3{
    color:#F3F4F6;
    margin-bottom:20px;
    text-align:center;
    font-size:24px;
    font-weight:800;
  }

  .resumen{
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    margin-bottom:18px;
    font-size:14px;
  }
  .resumen .badge{
    padding:6px 12px;
    border-radius:999px;
    font-weight:700;
  }

  .filtros{
    margin-bottom:18px;
    display:flex;
    flex-wrap:wrap;
    gap:8px;
  }
  .filtros .btn{
    padding:8px 14px;
    border-radius:12px;
    font-weight:700;
    border:none;
  }

  .table-responsive{
    width:100%;
    border-radius:14px;
    border:1px solid #1F2937;
    background:#111827;
    padding:12px;
    overflow:hidden;
    margin-top:5px;
  }

  .dt-buttons{
    text-align:right;
    margin-bottom:12px;
  }
  .dt-buttons .dt-button{
    padding:8px 14px;
    border-radius:10px;
    border:1px solid #1F2937;
    background:#3B82F6;
    color:#ffffff;
    font-weight:700;
    margin-left:8px;
  }
  .dt-buttons .dt-button:hover{
    background:#2563EB;
  }

  #tabla_reporte{
    width:100%;
    font-size:13px;
    color:#F3F4F6;
    margin:0;
  }

  #tabla_reporte thead th{
    background:#06080D;
    color:#F3F4F6;
    border-bottom:1px solid #1F2937;
    padding:10px;
    white-space:nowrap;
  }

  #tabla_reporte tbody td{
    background:#111827;
    color:#F3F4F6;
    border-top:1px solid #1F2937;
    padding:10px;
    vertical-align:middle;
    white-space:nowrap;
  }

  #tabla_reporte tbody tr:hover td{
    background:#0B1220;
  }

  @media (min-width:1200px){
    .box{
      margin-left:380px;
    }
  }

  @media (max-width:1200px){
    .box{
      margin-left:0;
      width:96%;
      max-width:100%;
    }
    .table-responsive{
      overflow-x:auto;
    }
  }
</style>

<div class="box">
  <h3>Reporte de estado de asignaciones</h3>
  <div class="resumen">
    <span class="badge bg-secondary">Total: {{ total }}</span>
    <span class="badge bg-success">Completados: {{ total_completados }}</span>
    <span class="badge bg-danger">Atrasados: {{ total_atrasados }}</span>
    <span class="badge bg-info text-dark">No completados: {{ total_nocomp }}</span>
    <span class="badge bg-warning text-dark">Pendientes: {{ total_pendientes }}</span>
  </div>
  <div class="filtros">
    <a href="{% url 'reporte_asignaciones' %}" class="btn btn-dark">Todos</a>
    <a href="?estado=COMPLETADO" class="btn btn-success">Completados</a>
    <a href="?estado=ATRASADO" class="btn btn-danger">Atrasados</a>
    <a href="?estado=NO_COMPLETADO" class="btn btn-info">No completados</a>
    <a href="?estado=PENDIENTE" class="btn btn-warning">Pendientes</a>
  </div>
  <div class="table-responsive">
    <table class="table table-bordered" id="tabla_reporte">
      <thead>
        <tr>
          <th>Usuario</th>
          <th>Evento</th>
          <th>Inicio</th>
          <th>Fin</th>
          <th>Asignado</th>
          <th>Estado</th>
          <th>Fecha cambio estado</th>
          <th>Creado por</th>
        </tr>
      </thead>
        <tbody>
        {% for a in asignaciones %}
            <tr>
            <td>{{ a.usuario.nombre_usuario }} {{ a.usuario.apellido_usuario }}</td>
            <td>{{ a.evento.titulo }}</td>

            <td>
                {{ a.evento.inicio_fecha }} {{ a.evento.inicio_hora|time:"h:i A" }}
            </td>

            <td>
                {% if a.evento.fin_fecha and a.evento.fin_hora %}
                {{ a.evento.fin_fecha }} {{ a.evento.fin_hora|time:"h:i A" }}
                {% else %}
                <span class="text-muted">Sin final</span>
                {% endif %}
            </td>

            <td>
                {% if a.fecha_asignacion %}
                {{ a.fecha_asignacion|date:"d-m-Y h:i A" }}
                {% else %}
                <span class="text-muted">-</span>
                {% endif %}
            </td>

            <td>
                {% if a.estado == "COMPLETADO" %}
                <span class="badge bg-success">Completado</span>
                {% elif a.estado == "ATRASADO" %}
                <span class="badge bg-danger">Atrasado</span>
                {% elif a.estado == "NO_COMPLETADO" %}
                <span class="badge bg-info text-dark">No completado</span>
                {% else %}
                <span class="badge bg-warning text-dark">Pendiente</span>
                {% endif %}
            </td>

            <td>
                {% if a.estado_fecha %}
                {{ a.estado_fecha|date:"d-m-Y h:i A" }}
                {% else %}
                <span class="text-muted">-</span>
                {% endif %}
            </td>

            <td>
                {{ a.evento.creado_por.usuario.nombre_usuario }}
                {{ a.evento.creado_por.usuario.apellido_usuario }}
            </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
  </div>
</div>

<script>
$(document).ready(function() {
  $('#tabla_reporte').DataTable({
    dom: 'Bfrtip',
    buttons: [
      { extend: 'copy', text: 'Copiar' },
      { extend: 'excel', text: 'Excel' },
      { extend: 'csv', text: 'CSV' },
      {
        extend: 'pdf',
        text: 'PDF',
        orientation: 'landscape',
        pageSize: 'A4'
      }
    ],
    language: {
      url: "//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json",
      emptyTable: "No hay asignaciones.",
      search: "Buscar:",
      lengthMenu: "Mostrar _MENU_ registros",
      info: "Mostrando _START_ a _END_ de _TOTAL_ registros",
      infoEmpty: "Mostrando 0 a 0 de 0 registros",
      infoFiltered: "(filtrado de _MAX_ registros totales)",
      paginate: { previous: "Anterior", next: "Siguiente" },
      zeroRecords: "No se encontraron resultados"
    }
  });
});
</script>

{% endblock %}
