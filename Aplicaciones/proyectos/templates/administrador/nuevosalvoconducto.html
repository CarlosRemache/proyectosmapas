{% extends "plantillaadministrador.html" %}
{% load static %}
{% block contener %}

<style>
  body{ background:#ffffff; }

  .box{
    width:92%;
    max-width:980px;
    margin:30px auto;
    background:#06080D;
    color:#F3F4F6;
    padding:26px;
    border-radius:20px;
    margin-left:380px;
    border:1px solid #1F2937;
    box-shadow:0 12px 30px rgba(0,0,0,0.4);
  }

  .box h3{
    margin-bottom:18px;
    font-weight:800;
    color:#F9FAFB;
    text-align:center;
  }

  .contenedor-ver-eventos{
    display:flex;
    justify-content:flex-end;
    margin-bottom:18px;
  }

  .contenedor-ver-eventos a{
    padding:10px 18px;
    border-radius:12px;
    font-weight:700;
    background:#3B82F6;
    color:#ffffff;
    text-decoration:none;
  }

  .contenedor-ver-eventos a:hover{
    background:#2563EB;
  }

  /* ===== SECCIONES ===== */
  .section-card{
    margin-top:28px;
    padding:20px;
    border-radius:16px;
    background:#0B1220;
    border:1px solid #1F2937;
  }

  .section-title{
    font-size:16px;
    font-weight:700;
    margin-bottom:14px;
    color:#E5E7EB;
    display:flex;
    align-items:center;
    gap:10px;
  }

  .section-title span{
    width:9px;
    height:9px;
    background:#3B82F6;
    border-radius:50%;
  }

  /* ===== TABLA ===== */
  .table-responsive{
    width:100%;
    border-radius:14px;
    border:1px solid #1F2937;
    background:#111827;
    padding:12px;
    overflow:auto;
  }

  #tbl_viajes{
    width:100%;
    font-size:13px;
    color:#F3F4F6;
  }

  #tbl_viajes thead th{
    background:#06080D;
    color:#F3F4F6;
    border-bottom:1px solid #1F2937;
    padding:10px;
    white-space:nowrap;
  }

  #tbl_viajes tbody td{
    background:#111827;
    color:#F3F4F6;
    border-top:1px solid #1F2937;
    padding:10px;
    white-space:nowrap;
  }

  #tbl_viajes tbody tr:hover td{
    background:#0B1220;
  }

  .dt-buttons{
    text-align:right;
    margin-bottom:12px;
  }

  .dt-buttons .dt-button{
    padding:8px 14px;
    border-radius:10px;
    border:1px solid #1F2937;
    background:#3B82F6;
    color:#fff;
    font-weight:700;
    margin-left:6px;
  }

  .dt-buttons .dt-button:hover{
    background:#2563EB;
  }

  /* ===== FORMULARIO ===== */
  .form-grid{
    display:grid;
    grid-template-columns:repeat(2,1fr);
    gap:16px;
  }

  .form-grid-full{
    grid-column:1 / -1;
  }

  label{
    margin-top:6px;
    font-weight:600;
    color:#A1A1AA;
    display:block;
  }

  .form-control{
    margin-top:6px;
    background:#06080D;
    color:#F3F4F6;
    border:1px solid #1F2937;
    border-radius:10px;
    padding:10px;
  }

  .form-control:focus{
    border-color:#3B82F6;
    box-shadow:0 0 0 3px rgba(59,130,246,0.25);
    outline:none;
  }

  .form-actions{
    display:flex;
    justify-content:flex-end;
    margin-top:24px;
  }

  .btn-save{
    background:#3B82F6;
    color:#ffffff;
    font-weight:800;
    padding:12px 22px;
    border-radius:12px;
    border:none;
    cursor:pointer;
  }

  .btn-save:hover{
    background:#2563EB;
  }

  @media (max-width:1200px){
    .box{ margin-left:0; width:96%; }
    .form-grid{ grid-template-columns:1fr; }
  }
</style>

<div class="box">
  <h3>Nuevo Salvoconducto</h3>

  <div class="contenedor-ver-eventos">
    <a href="{% url 'salvoconductos' %}">Listado de salvoconductos</a>
  </div>

  <!-- ================= TABLA ================= -->
  <div class="section-card">
    <div class="section-title">
      <span></span> Viajes registrados
    </div>

    <div class="table-responsive">
      <table id="tbl_viajes" class="table table-bordered table-striped">
        <thead>
          <tr>
            <th>Viaje</th>
            <th>Usuario</th>
            <th>Vehículo</th>
            <th>Combustible</th>
            <th>Destino</th>
            <th>Fecha</th>
          </tr>
        </thead>
        <tbody>
          {% for v in viajes %}
          <tr>
            <td>{{ v.id_viaje }}</td>
            <td>{{ v.usuario }}</td>
            <td>{{ v.vehiculo }}</td>
            <td>{{ v.tipo_combustible }}</td>
            <td>{{ v.destino }}</td>
            <td>{{ v.fecha }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- ================= FORMULARIO ================= -->
  <div class="section-card">
    <div class="section-title">
      <span></span> Datos del salvoconducto
    </div>

    <form method="post">
      {% csrf_token %}

      <div class="form-grid">
        <div>
          <label>Usuario</label>
          <select name="usuario" class="form-control" required>
            {% for u in usuarios %}
              <option value="{{ u.id_usuario }}">{{ u.nombre_usuario }}</option>
            {% endfor %}
          </select>
        </div>

        <div>
          <label>Vehículo</label>
          <select name="vehiculo" class="form-control" required>
            {% for v in vehiculos %}
              <option value="{{ v.id_vehiculo }}">{{ v.matricula_vehiculo }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="form-grid-full">
          <label>Viaje</label>
          <select name="viaje" class="form-control" required>
            {% for v in viajes %}
              <option value="{{ v.id_viaje }}">Viaje #{{ v.id_viaje }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="form-grid-full">
          <label>Motivo</label>
          <textarea name="motivo" class="form-control" rows="3" required></textarea>
        </div>

        <div>
          <label>Fecha inicio</label>
          <input type="date" name="fecha_inicio" class="form-control" required>
        </div>

        <div>
          <label>Fecha fin</label>
          <input type="date" name="fecha_fin" class="form-control" required>
        </div>

        <div class="form-grid-full">
          <label>Estado</label>
          <select name="estado" class="form-control">
            <option value="VIGENTE">VIGENTE</option>
            <option value="VENCIDO">VENCIDO</option>
            <option value="ANULADO">ANULADO</option>
          </select>
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn-save">Guardar salvoconducto</button>
      </div>
    </form>
  </div>
</div>

<script>
$(document).ready(function() {
  $('#tbl_viajes').DataTable({
    dom: 'Bfrtip',
    buttons: [
      { extend: 'copy', text: 'Copiar' },
      { extend: 'excel', text: 'Excel' },
      { extend: 'csv', text: 'CSV' },
      { extend: 'pdf', text: 'PDF', orientation: 'landscape', pageSize: 'A4' }
    ],
    language: {
      url: "//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json"
    }
  });
});
</script>

{% endblock %}
