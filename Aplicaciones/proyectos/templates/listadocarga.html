{% extends "./plantilla.html" %}
{% load static %}
{% block contenido %}

<style>
  body { background-color:#000; font-family: Arial, sans-serif; }

  .carga-container{
    max-width: 1100px;  
    margin: 70px auto;
    background:#222;
    padding: 26px;
    border-radius: 20px;
    color:#fff;
    text-align:center;
    box-shadow:0 4px 25px rgba(0,0,0,.7);
  }

  .barra{
    width:260px; height:18px;
    background:#444;
    margin:0 auto 18px auto;
    border-radius:10px;
  }

  h3{ 
    font-size:22px;
    margin-bottom:18px;
    color:#fff; 
    text-transform: uppercase;
  }

  .acciones-top{
    display:flex;
    justify-content: space-between;
    align-items:center;
    margin-bottom: 15px;
    gap:10px;
    flex-wrap: wrap;
  }

  .btn-verde{
    padding:10px 16px;
    background:#00d13a;
    color:#000;
    font-weight:800;
    border-radius:12px;
    border:none;
    cursor:pointer;
    font-size:15px;
    text-decoration:none;
    display:inline-flex;
    align-items:center;
    justify-content:center;
  }
  .btn-verde:hover{
    background:#00aa30;
  }

  .resumen-peso{
    font-size:14px;
    color:#ddd;
    margin-top:5px;
  }

  .table-responsive{
    width:100%;
    margin-top: 14px;
    border-radius:14px;
    border:1px solid #333;
    background:#1b1b1b;
    padding:12px;
    overflow:hidden;
    text-align:left;
  }

  #tbl_cargas{
    width:100%;
    font-size:13px;
    color:#F3F4F6;
    margin:0;
  }

  #tbl_cargas thead th{
    background:#111;
    color:#F3F4F6;
    border-bottom:1px solid #333 ;
    padding:10px;
    white-space:nowrap;
  }

  #tbl_cargas tbody td{
    background:#1b1b1b;
    color:#F3F4F6;
    border-top:1px solid #333 ;
    padding:10px;
    vertical-align:middle;
  }

  #tbl_cargas tbody tr:hover td{
    background:#141414;
  }

  .dt-buttons{
    text-align:right;
    margin-bottom:10px;
  }
  .dt-buttons .dt-button{
    padding:10px 14px;
    border-radius:10px;
    border:1px solid #333;
    background:#00d13a;
    color:#000;
    font-weight:900;
    margin-left:8px;
  }
  .dt-buttons .dt-button:hover{
    filter:brightness(.95);
  }

  .dataTables_filter label,
  .dataTables_length label,
  .dataTables_info{
    color:#d1d5db;
    font-weight:600;
  }

  .dataTables_filter input{
    background:#0f0f0f;
    color:#fff;
    border:1px solid #333;
    border-radius:10px;
    padding:8px 10px;
    outline:none;
  }

  .dataTables_length select{
    background:#0f0f0f;
    color:#fff;
    border:1px solid #333;
    border-radius:10px;
    padding:6px 10px;
  }

  .dataTables_paginate{
    margin-top:10px;
  }
  .dataTables_paginate .paginate_button{
    padding:8px 12px;
    border-radius:10px;
    border:1px solid #333;
    background:#0f0f0f;
    color:#fff !important;
    margin-left:6px;
  }
  .dataTables_paginate .paginate_button:hover{
    background:#191919;
  }
  .dataTables_paginate .paginate_button.current{
    background:#00d13a !important;
    color:#000 !important;
    border-color:#00d13a;
  }

  .btn-accion{
    padding:7px 10px;
    border-radius:10px;
    border:none;
    cursor:pointer;
    font-weight:900;
    font-size:13px;
    text-decoration:none;
    display:inline-block;
  }

  .btn-editar{
    background:#1e88e5;
    color:#fff;
  }
  .btn-editar:hover{
    background:#1565c0;
  }

  .btn-eliminar{
    background:#ff4444;
    color:#fff;
  }
  .btn-eliminar:hover{
    background:#cc0000;
  }

  .no-datos{
    color:#fff;
    text-align:center;
    margin-top:15px;
  }

  @media (max-width: 768px){
    .carga-container{ padding:16px; }
    .acciones-top{ flex-direction:column; align-items:flex-start; }
    .table-responsive{ overflow-x:auto; }
    .dt-buttons{ text-align:left; }
    .dt-buttons .dt-button{ margin:6px 6px 0 0; }
  }
</style>

<div class="carga-container">
  <div class="barra"></div>

  <h3>Listado de Cargas del Vehículo</h3>

  <div class="acciones-top">
    <div>
      {% if vehiculo %}
        <div class="resumen-peso">
          Vehículo: <b>{{ vehiculo.matricula_vehiculo }}</b> ({{ vehiculo.tipovehiculo_vehiculo }})<br>
          Peso base vehículo: <b>{{ vehiculo.peso_auto }} kg</b><br>
          Peso total de carga: <b>{{ total_carga_kg }} kg</b>
        </div>
      {% endif %}
    </div>
      <a href="/nuevacarga/" class="btn-verde">+ Nueva carga</a>
      <a href="/inicio/" class="btn-verde">Menú</a>
  </div>

  {% if cargas %}
    <div class="table-responsive">
      <table class="table table-bordered table-striped" id="tbl_cargas">
        <thead>
          <tr>
            <th>ID</th>
            <th>Vehículo</th>
            <th>Producto / Carga</th>
            <th>Peso adicional (kg)</th>
            <th>Acciones</th>
          </tr>
        </thead>

        <tbody>
          {% for c in cargas %}
            <tr>
              <td>{{ c.id_carga }}</td>
              <td>
                {{ c.vehiculo.matricula_vehiculo }}<br>
                <span style="font-size:11px; color:#bbb;">
                  {{ c.vehiculo.tipovehiculo_vehiculo }}
                </span>
              </td>
              <td><b>{{ c.nombre_producto }}</b></td>
              <td>{{ c.peso_adicional }}</td>
              <td style="white-space:nowrap;">
                <a href="/editarcarga/{{ c.id_carga }}/" class="btn-accion btn-editar">
                  Editar
                </a>
                <a href="/eliminarcarga/{{ c.id_carga }}/"
                   class="btn-accion btn-eliminar"
                   onclick="return confirm('¿Seguro que deseas eliminar esta carga?');">
                  Eliminar
                </a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="no-datos">No hay cargas registradas todavía.</p>
  {% endif %}
</div>

<script>
$(document).ready(function () {
  $('#tbl_cargas').DataTable({
    order: [[0, 'asc']],
    dom: 'Bfrtip',
    buttons: [
      { extend: 'copy', text: 'Copiar' },
      { extend: 'excel', text: 'Excel' },
      { extend: 'csv', text: 'CSV' },
      { extend: 'pdf', text: 'PDF', orientation: 'landscape', pageSize: 'A4' }
    ],
    language: {
      url: "//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json",
      search: "Buscar:",
      lengthMenu: "Mostrar _MENU_ registros",
      info: "Mostrando _START_ a _END_ de _TOTAL_ registros",
      infoEmpty: "Mostrando 0 a 0 de 0 registros",
      infoFiltered: "(filtrado de _MAX_ registros totales)",
      paginate: { previous: "Anterior", next: "Siguiente" },
      zeroRecords: "No se encontraron resultados"
    }
  });
});
</script>

{% endblock %}
